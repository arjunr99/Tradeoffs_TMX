%%% ------ 9/8 Transmultiplexer ----- %%%

clear all;
close all;
clc;
N = 9;                      % Number of carriers
K = 8;                      % Upsampling

d1 = lt_poly({1;[0 1];[0 0 1]; [zeros(1,3) 1];[zeros(1,4) 1]; [zeros(1,5) 1];[zeros(1,6) 1]; [zeros(1,7) 1]; [zeros(1,8) 1]},0);

d2 = lt_poly({1; [zeros(1,9) 1]; [zeros(1,18) 1]; [zeros(1,27) 1]; [zeros(1,36) 1] ;[zeros(1,45) 1] ; [zeros(1,54) 1] ; [zeros(1,63) 1]},0);
d3 = lt_poly({1 [zeros(1,63) 1] [zeros(1,54) 1] [zeros(1,45) 1] [zeros(1,36) 1] [zeros(1,27) 1] [zeros(1,18) 1] [zeros(1,9) 1] 1},0);
d3 = diag(d3);
d2 = diag(d2);
d = lt_poly({1},-72);

%%%%%%%-----test-part -------%%%%%%%

y = lt_poly({[zeros(1,63) 1] 0 0 0 0 0 0 0 0;[zeros(1,54) 1] [zeros(1,63) 1] 0 0 0 0 0 0 0; [zeros(1,45) 1] 0 [zeros(1,63) 1]  0 0 0 0 0 0 ; [zeros(1,36) 1] 0 0 [zeros(1,63) 1] 0 0 0 0 0; [zeros(1,27) 1] 0 0 0 [zeros(1,63) 1] 0 0 0 0; [zeros(1,18) 1] 0 0 0 0 [zeros(1,63) 1]  0 0 0; [zeros(1,9) 1] 0 0 0 0 0 [zeros(1,63) 1]  0 0; 1 0 0 0 0 0 0 [zeros(1,63) 1] 0 ; 0 0 0 0 0 0 0 0 [zeros(1,63) 1]},0);

%%%%%%%-----test-test -------%%%%%%%

v = [0.332513331865706,0.812466688860795,0.813195264072731,0.196763853381694,0.765303404560972,0.838721170052876,0.149682694060237,0.879038355411265,-0.196139520059379,0.951924909643200,0.501075282837169,1.18299295615088,-0.355592487260189,0.169399661067415,0.990986923282182,0.991199209240708,0.967290366837122,-0.337666767755090,0.178268668005953,-0.0944935273140622,0.947768548156431,1.05797745771949,0.543624200043122,-0.212576163842149,0.116983109311116,-0.0691073215999458,0.0377390910538557,1.02276193036031,1.07810909026937,0.303664250485231,-0.135224757675271,0.0747376220038424,-0.0452215148450577,0.0278097189424282,-0.0154030544134163,1.47337607531396,1.45863948827755,0.187872439385931,-0.107491525295587,0.0611978693297747,-0.0344425735270783,0.0209143047716258,-0.0125453065495534,0.00692722345720449];

%v = [0.946317688602810,0.0306438465516889,0.672887513350028,-0.426474875492508,1.00223518304691,0.589472403988116,0.531400418805247,1.11264670657146,-0.0816468325578785,0.902970243285337,1.15553483277768,0.911121674527010,-0.112245228888777,-0.0136185767616103,1.15804197941281,1.35389911122932,0.626255243337114,-0.0948525923176854,-0.0157517408115939,0.0548596752761813,1.18588131540973,1.20761105358784,0.347221653535050,-0.0550640629348043,-0.0264952703327181,0.0645815756122970,-0.0789811503254479,1.20184896035166,1.06991274613632,0.179139942351301,-0.0233626157562745,-0.0397446575981822,0.0796833711694513,-0.104035929461313,0.113532428876615,1.68268615311496,1.37159765533757,0.106155582328715,-0.00267870316000434,-0.0696132190618614,0.135218246105848,-0.192100282544556,0.232885937945175,-0.247317547807597,0.875780027335165,0.0272792795514726,-0.0855583811236969,0.197358290050106,-0.363650443095166,0.564768756768040,-0.761571873852935,0.907175165355091,-0.959371306979024];
fun = @solv_rot;
options = optimoptions('fsolve','Display','iter');
options.MaxFunEvals = 100000;
options.MaxIter = 4800;
options.TolFun = 1e-10;
%options.TolX = 1e-10;
%v = fsolve(fun,v0,options);

h = unitary_mat_9_8(v(1:44));

%v1 = v(45:53);
W = dftmtx(8);

%H = eye(9) - (v1'*v1)/(v1*v1') + d* ((v1'*v1)/(v1*v1'));
Y = d1'*d3*h*d2*W;
coef = GetCoefs(Y);
a = coef{1};
b = coef{2};